CREATE DATABASE QL_QUANCAFE;

USE QL_QUANCAFE;

CREATE TABLE NHANVIEN (
    MANV VARCHAR(50) PRIMARY KEY,
    TENNV NVARCHAR(100),
    DIACHI NVARCHAR(255),
	NGAYVAOLAM DATE,
    GIOITINH BIT,
    SDT VARCHAR(20),
    MATKHAU NVARCHAR(255)
);

CREATE TABLE LOAIKHACHHANG (
    MALKH VARCHAR(50) PRIMARY KEY,
    TENLKH NVARCHAR(100),
    GIAMGIA INT
);

CREATE TABLE KHACHHANG (
    MAKH VARCHAR(50) PRIMARY KEY,
    MALKH VARCHAR(50),
    TENKH NVARCHAR(100),
    DIACHI NVARCHAR(255),
    SDT VARCHAR(20),
    DIEMTL INT,
    FOREIGN KEY (MALKH) REFERENCES LOAIKHACHHANG(MALKH)
);

CREATE TABLE LOAIHANGHOA (
    MALH VARCHAR(50) PRIMARY KEY,
    TENLH NVARCHAR(100),
    MOTA NVARCHAR(MAX)
);

CREATE TABLE HANGHOA (
    MAHH VARCHAR(50) PRIMARY KEY,
    MALH VARCHAR(50),
    TENHH NVARCHAR(100),
    HINHANH NVARCHAR(255),
    GIASP DECIMAL(18,2),
    FOREIGN KEY (MALH) REFERENCES LOAIHANGHOA(MALH)
);

CREATE TABLE HOADONBANHANG (
    MAHDBH VARCHAR(50) PRIMARY KEY,
    MANV VARCHAR(50),
    MAKH VARCHAR(50),
    NGAYHDBH DATE,
    TONGTIEN DECIMAL(18,2),
    DIEMTL INT,
    GIAMGIA INT,
    FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
);

CREATE TABLE CHITIETHOADON (
    MACT_HD VARCHAR(50) PRIMARY KEY,
    MAHDBH VARCHAR(50),
    MAHH VARCHAR(50),
    SOLUONG INT,
    THANHTIEN DECIMAL(18,2),
    FOREIGN KEY (MAHDBH) REFERENCES HOADONBANHANG(MAHDBH),
    FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH)
);

CREATE TABLE MAGIAMGIA (
    MAGIAM VARCHAR(50),
    GIAMGIA INT
);

--Tao user de vao DB
create login QLQuanCafe with password = '123'
create user QLQuanCafe for login QLQuanCafe
create role role_QuanCafe
grant insert, select, update, delete
to role_QuanCafe
exec sp_addrolemember role_QuanCafe, QLQuanCafe;

CREATE FUNCTION FN_LAY_MAGIAMGIA()
RETURNS TABLE
AS
RETURN (
    SELECT * FROM MAGIAMGIA
);


CREATE FUNCTION FN_LAY_MAGIAMGIA()
RETURNS TABLE
AS
RETURN (
    SELECT * FROM MAGIAMGIA
);